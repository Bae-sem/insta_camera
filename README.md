# Insta360 Pro 2 Camera Calibration & Control

Insta360 Pro 2 ì¹´ë©”ë¼ì˜ ì œì–´ ë° ìº˜ë¦¬ë¸Œë ˆì´ì…˜ì„ ìœ„í•œ í†µí•© í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
insta_camera/
â”œâ”€â”€ README.md                 # ì´ ë¬¸ì„œ
â”œâ”€â”€ photos/                   # ì´¬ì˜ëœ ì´ë¯¸ì§€ ì €ì¥ í´ë”
â”‚   â”œâ”€â”€ origin_1.jpg ~ origin_6.jpg  # 6ê°œ í”¼ì‰¬ì•„ì´ ì¹´ë©”ë¼ ì›ë³¸ ì´ë¯¸ì§€
â”‚   â”œâ”€â”€ pano.jpg              # íŒŒë…¸ë¼ë§ˆ ì´ë¯¸ì§€
â”‚   â””â”€â”€ thumbnail.jpg         # ì¸ë„¤ì¼
â”œâ”€â”€ AnyCalib/                 # ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ config.json           # ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì„¤ì • íŒŒì¼
â”‚   â”œâ”€â”€ predict_insta360.py   # ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ anycalib.json         # ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ê²°ê³¼ (ìë™ ìƒì„±)
â”‚   â””â”€â”€ anycalib_results/     # ë³´ì •ëœ ì´ë¯¸ì§€ ì €ì¥ í´ë”
â””â”€â”€ insta360_ws/              # ì¹´ë©”ë¼ ì œì–´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤
    â”œâ”€â”€ insta360/             # Python ì¹´ë©”ë¼ ì œì–´ ëª¨ë“ˆ
    â””â”€â”€ scripts/              # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
```

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ (AnyCalib)
Insta360 Pro 2ì˜ 6ê°œ í”¼ì‰¬ì•„ì´ ì¹´ë©”ë¼ì— ëŒ€í•œ ë‚´ë¶€ íŒŒë¼ë¯¸í„°(Intrinsic Parameters) ì¶”ì •

### 2. ì¹´ë©”ë¼ ì œì–´ (insta360_ws)
Insta360 Pro 2 ì¹´ë©”ë¼ ì—°ê²°, ì‚¬ì§„ ì´¬ì˜, ì˜ìƒ ë…¹í™”, í”„ë¦¬ë·° ë“±

---

## ğŸ› ï¸ ì„¤ì¹˜

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Python â‰¥ 3.10
- PyTorch (CUDA ê¶Œì¥)
- OpenCV (ì´ë¯¸ì§€ ë³´ì •ìš©)

### AnyCalib ì„¤ì¹˜

```bash
cd AnyCalib
pip install -e .
```

íš¨ìœ¨ì ì¸ ì‹¤í–‰ì„ ìœ„í•´ xformersë„ ì„¤ì¹˜í•˜ë ¤ë©´:
```bash
pip install -e .[eff]
```

---

## ğŸ“· ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì‚¬ìš©ë²•

### Step 1: ì´ë¯¸ì§€ ì¤€ë¹„
`photos/` í´ë”ì— Insta360 Pro 2ì—ì„œ ì´¬ì˜í•œ 6ê°œì˜ í”¼ì‰¬ì•„ì´ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
- íŒŒì¼ëª… í˜•ì‹: `origin_1.jpg`, `origin_2.jpg`, ..., `origin_6.jpg`

### Step 2: ì„¤ì • íŒŒì¼ ìˆ˜ì •
`AnyCalib/config.json` íŒŒì¼ì—ì„œ ì›í•˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì¡°ì •í•©ë‹ˆë‹¤:

```json
{
    "model": {
        "model_id": "anycalib_gen"
    },
    "camera": {
        "cam_id": "kb:4"
    },
    "input": {
        "image_dir": "../photos",
        "image_pattern": "origin_{}.jpg",
        "image_indices": [1, 2, 3, 4, 5, 6]
    },
    "output": {
        "output_dir": "anycalib_results",
        "json_file": "anycalib.json",
        "save_undistorted": true
    }
}
```

### Step 3: ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì‹¤í–‰

```bash
cd AnyCalib
python predict_insta360.py
```

ë˜ëŠ” ì„¤ì • íŒŒì¼ ê²½ë¡œë¥¼ ì§ì ‘ ì§€ì •:
```bash
python predict_insta360.py --config config.json
```

### Step 4: ê²°ê³¼ í™•ì¸
- **ìº˜ë¦¬ë¸Œë ˆì´ì…˜ íŒŒë¼ë¯¸í„°**: `AnyCalib/anycalib.json`
- **ë³´ì •ëœ ì´ë¯¸ì§€**: `AnyCalib/anycalib_results/`

---

## âš™ï¸ ì„¤ì • íŒŒì¼ (config.json) ìƒì„¸

### ëª¨ë¸ ì„¤ì • (`model`)

| íŒŒë¼ë¯¸í„°   | ì„¤ëª…                  | ì˜µì…˜                                                                                                                                                     |
| ---------- | --------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `model_id` | ì‚¬ì „ í•™ìŠµëœ ëª¨ë¸ ì„ íƒ | `anycalib_pinhole`: ì¼ë°˜ í•€í™€ ì¹´ë©”ë¼<br>`anycalib_gen`: ì¼ë°˜ + ì™œê³¡ ì´ë¯¸ì§€ (ê¶Œì¥)<br>`anycalib_dist`: ì™œê³¡ ì´ë¯¸ì§€ ì „ìš©<br>`anycalib_edit`: í¸ì§‘ëœ ì´ë¯¸ì§€ |

### ì¹´ë©”ë¼ ëª¨ë¸ ì„¤ì • (`camera`)

| `cam_id`   | ì„¤ëª…                                | íŒŒë¼ë¯¸í„° ìˆ˜               |
| ---------- | ----------------------------------- | ------------------------- |
| `pinhole`  | ê¸°ë³¸ í•€í™€ ëª¨ë¸                      | 4 (fx, fy, cx, cy)        |
| `kb:4`     | Kannala-Brandt í”¼ì‰¬ì•„ì´ ëª¨ë¸ (ê¶Œì¥) | 8 (fx, fy, cx, cy, k1-k4) |
| `radial:k` | Brown-Conrady ë°©ì‚¬í˜• ì™œê³¡ (k=1-4)   | 4+k                       |
| `ucm`      | Unified Camera Model                | 5                         |
| `eucm`     | Enhanced UCM                        | 6                         |

**Insta360 Pro 2 í”¼ì‰¬ì•„ì´ ë Œì¦ˆì—ëŠ” `kb:4` (Kannala-Brandt) ëª¨ë¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤.**

### ì…ë ¥ ì„¤ì • (`input`)

| íŒŒë¼ë¯¸í„°        | ì„¤ëª…                        | ê¸°ë³¸ê°’               |
| --------------- | --------------------------- | -------------------- |
| `image_dir`     | ì´ë¯¸ì§€ í´ë” ê²½ë¡œ            | `../photos`          |
| `image_pattern` | íŒŒì¼ëª… íŒ¨í„´ (`{}`ëŠ” ì¸ë±ìŠ¤) | `origin_{}.jpg`      |
| `image_indices` | ì²˜ë¦¬í•  ì¹´ë©”ë¼ ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸ | `[1, 2, 3, 4, 5, 6]` |

### ì¶œë ¥ ì„¤ì • (`output`)

| íŒŒë¼ë¯¸í„°             | ì„¤ëª…                       | ê¸°ë³¸ê°’             |
| -------------------- | -------------------------- | ------------------ |
| `output_dir`         | ë³´ì • ì´ë¯¸ì§€ ì €ì¥ í´ë”      | `anycalib_results` |
| `json_file`          | ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ê²°ê³¼ íŒŒì¼     | `anycalib.json`    |
| `save_undistorted`   | ì™œê³¡ ë³´ì • ì´ë¯¸ì§€ ì €ì¥ ì—¬ë¶€ | `true`             |
| `undistorted_prefix` | ë³´ì • ì´ë¯¸ì§€ íŒŒì¼ëª… ì ‘ë‘ì–´  | `calib_photo`      |

### ìµœì í™” ì„¤ì • (`optimization`)

| íŒŒë¼ë¯¸í„°            | ì„¤ëª…                   | ê¸°ë³¸ê°’         |
| ------------------- | ---------------------- | -------------- |
| `nonlin_opt_method` | ë¹„ì„ í˜• ìµœì í™” ë°©ë²•     | `gauss_newton` |
| `init_with_sac`     | RANSAC ì´ˆê¸°í™” ì‚¬ìš©     | `false`        |
| `fallback_to_sac`   | ì‹¤íŒ¨ì‹œ RANSAC ì‚¬ìš©     | `true`         |
| `rm_borders`        | ë¬´ì‹œí•  í…Œë‘ë¦¬ í¬ê¸°     | `0`            |
| `sample_size`       | ìƒ˜í”Œë§ í¬ê¸° (-1: ì „ì²´) | `-1`           |

### ë””ë°”ì´ìŠ¤ ì„¤ì • (`device`)

| íŒŒë¼ë¯¸í„°   | ì„¤ëª…          | ê¸°ë³¸ê°’ |
| ---------- | ------------- | ------ |
| `use_cuda` | GPU ì‚¬ìš© ì—¬ë¶€ | `true` |

---

## ğŸ“Š ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ê²°ê³¼ í˜•ì‹

`anycalib.json` íŒŒì¼ì€ ê° ì¹´ë©”ë¼ë³„ë¡œ ë‚´ë¶€ íŒŒë¼ë¯¸í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤:

```json
{
    "origin_1.jpg": [fx, fy, cx, cy, k1, k2, k3, k4],
    "origin_2.jpg": [fx, fy, cx, cy, k1, k2, k3, k4],
    ...
}
```

### íŒŒë¼ë¯¸í„° ì„¤ëª…
- `fx, fy`: ì´ˆì  ê±°ë¦¬ (í”½ì…€ ë‹¨ìœ„)
- `cx, cy`: ì£¼ì  (Principal Point) ì¢Œí‘œ
- `k1, k2, k3, k4`: ì™œê³¡ ê³„ìˆ˜ (Kannala-Brandt ëª¨ë¸)

---

## ğŸ”§ ê³ ê¸‰ ì‚¬ìš©ë²•

### íŠ¹ì • ì¹´ë©”ë¼ë§Œ ìº˜ë¦¬ë¸Œë ˆì´ì…˜

`config.json`ì—ì„œ `image_indices`ë¥¼ ìˆ˜ì •:
```json
"image_indices": [1, 3, 5]
```

### ë‹¤ë¥¸ ì¹´ë©”ë¼ ëª¨ë¸ ì‚¬ìš©

í”¼ì‰¬ì•„ì´ê°€ ì•„ë‹Œ ì¼ë°˜ í•€í™€ ì¹´ë©”ë¼:
```json
{
    "model": {
        "model_id": "anycalib_pinhole"
    },
    "camera": {
        "cam_id": "pinhole"
    }
}
```

### ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ê²½ë¡œ

```json
{
    "input": {
        "image_dir": "/path/to/your/images",
        "image_pattern": "camera_{}.png",
        "image_indices": [0, 1, 2]
    }
}
```

---

## â“ ë¬¸ì œ í•´ê²°

### CUDA ë©”ëª¨ë¦¬ ë¶€ì¡±
`config.json`ì—ì„œ `use_cuda`ë¥¼ `false`ë¡œ ì„¤ì •í•˜ì—¬ CPU ì‚¬ìš©:
```json
{
    "device": {
        "use_cuda": false
    }
}
```

### ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
- `image_dir` ê²½ë¡œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- `image_pattern`ê³¼ `image_indices`ê°€ ì‹¤ì œ íŒŒì¼ëª…ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

### ì™œê³¡ ë³´ì • ê²°ê³¼ê°€ ì´ìƒí•¨
- Insta360 Pro 2 í”¼ì‰¬ì•„ì´ì—ëŠ” `kb:4` ëª¨ë¸ ì‚¬ìš© ê¶Œì¥
- `model_id`ë¥¼ `anycalib_gen` ë˜ëŠ” `anycalib_dist`ë¡œ ë³€ê²½

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [AnyCalib ë…¼ë¬¸](https://arxiv.org/abs/2503.12701)
- [AnyCalib GitHub](https://github.com/javrtg/AnyCalib)
- [Insta360 Pro 2 ì‚¬ì–‘](https://www.insta360.com/product/insta360-pro2)

---

## ğŸ“œ ë¼ì´ì„ ìŠ¤

AnyCalib ì½”ë“œì™€ ê°€ì¤‘ì¹˜ëŠ” Apache 2.0 ë¼ì´ì„ ìŠ¤ í•˜ì— ì œê³µë©ë‹ˆë‹¤.
